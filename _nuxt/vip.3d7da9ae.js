import{_ as N}from"./mx-icon.32edc059.js";import{_ as k}from"./mx-btn.d7ca5fda.js";import{_ as M}from"./mx-input-num.c4966364.js";import{_ as $}from"./mx-link.b5144ebc.js";import{_ as A}from"./mx-checkbox.c2525bb3.js";import{_ as I}from"./mx-dialog.047d8f01.js";import{_ as x,p as D}from"./api-profile.77d1f083.js";import{g as B}from"./index.980b4d70.js";import{o as l,c as v,w as d,h as a,i as h,t as o,e as u,F as C,f,b as t,s as w,C as S,r as K}from"./entry.ce67fe4b.js";import{_ as L}from"./_plugin-vue_export-helper.c27b6911.js";import{_ as O}from"./layout.0bc348b9.js";import{a as y}from"./api-asset.f95e858a.js";import"./nuxt-link.a2896ab1.js";import"./mx-loading.4ecc75fb.js";import"./request.5554df2c.js";const R={name:"VerifyPass",components:{MxBtn:k,MxImage:x,MxDialog:I},props:{titleKey:{type:String,default:""},descKey:{type:String,default:""}},emits:["success","cancel"],data(){return{profileData:{},tfaEnabled:!1,isLodaing:!1,passOrigin:void 0,tfaCode:void 0}},created(){this.getUserData()},methods:{async getUserData(){var n;const e=await D.getProfile(),s=typeof e.options=="object"?e.options:JSON.parse(e.options||"{}");this.profileData=e,this.tfaEnabled=(n=s==null?void 0:s.tfa)==null?void 0:n.enabled},handleCancel(){this.$emit("cancel")},async handleSubmit(){this.isLodaing=!0;const e=await B(this.passOrigin),s={account:this.profileData.account,password:e},n=await D.verifyPassword(s);if(n.code){this.isLodaing=!1,this.$toast.error(n.msg||n.message);return}if(this.tfaEnabled){const p=await D.verify2faCode(this.tfaCode);if(p.code){this.isLodaing=!1,this.$toast.error(p.msg||p.message);return}}this.isLodaing=!1,this.$emit("success",{passOrigin:this.passOrigin,passSha256:e,tfaCode:this.tfaCode})}}},H={key:0,class:"mx-mb-20"},U={style:{"text-align":"center"}},z={class:"verify-pass-nick"},F=["placeholder"],j=["placeholder"];function G(e,s,n,p,i,c){const m=x,g=k,b=I;return l(),v(b,{title:n.titleKey||"profilePassConfirm"},{footer:d(()=>[a(g,{onClick:c.handleCancel},{default:d(()=>[h(o(e.$t("btnCancel")),1)]),_:1},8,["onClick"]),a(g,{type:"primary",disabled:i.isLodaing||!i.passOrigin||i.tfaEnabled&&!i.tfaCode,onClick:c.handleSubmit},{default:d(()=>[h(o(e.$t("btnContirm")),1)]),_:1},8,["disabled","onClick"])]),default:d(()=>[n.descKey!==null?(l(),u("div",H,[n.descKey?(l(),u(C,{key:0},[h(o(e.$t(n.descKey)),1)],64)):(l(),u(C,{key:1},[h(o(e.$t("profilePassConfirmTips",{tfaCode:i.tfaEnabled?e.$t("profilePassConfirmTips2"):""})),1)],64))])):f("",!0),t("div",U,[a(m,{class:"verify-pass-avatar","image-url":i.profileData.avatar_url},null,8,["image-url"]),t("div",z,o(i.profileData.nickname),1),w(t("input",{"onUpdate:modelValue":s[0]||(s[0]=_=>i.passOrigin=_),maxlength:20,placeholder:e.$t("profilePassInput"),type:"password",class:"verify-pass-input"},null,8,F),[[S,i.passOrigin]]),i.tfaEnabled?w((l(),u("input",{key:0,"onUpdate:modelValue":s[1]||(s[1]=_=>i.tfaCode=_),placeholder:e.$t("profile2faInput"),class:"verify-pass-input"},null,8,j)),[[S,i.tfaCode]]):f("",!0)])]),_:1},8,["title"])}const J=L(R,[["render",G]]);const q={setup(){},data(){return{assetData:void 0,vipInfo:{enabled:!1,cycleDays:void 0,monthPrice:void 0,priceIcon:void 0},expireDate:void 0,renewEnable:!1,rightKeys:["checkin","vip","video","feature","bookmark","waiting"],confirmDialogVisible:!1,monthNum:1,isAgree:!0,passDialogType:"",isLoading:!1}},computed:{totalDays(){return this.monthNum*this.vipInfo.cycleDays},totalPrice(){return this.monthNum*this.vipInfo.monthPrice},goldNotEnough(){var e,s;return((s=(e=this.assetData)==null?void 0:e.gold)==null?void 0:s.balance)<this.totalPrice},confirmBtnDisabled(){return this.isLoading||!this.isAgree||this.goldNotEnough},agreeHtml(){return this.$t("vipAgree1").replace("[link]",`<a href="/docs/vip" target="_blank">${this.$t("vipAgree2")}</a>`)}},methods:{handleInit({profile:e,asset:s}){var n,p;this.assetData=s,this.vipInfo.enabled=((n=e==null?void 0:e.vip)==null?void 0:n.state)==="enabled"&&((p=e==null?void 0:e.vip)==null?void 0:p.level)>0,this.getVipInfo(),this.vipInfo.enabled&&this.getSubInfo()},async getVipInfo(){var n,p,i;const e=await y.getSubscriptionList(),s=(p=(n=e.upgrade_vip)==null?void 0:n.level[1])==null?void 0:p.split("|");this.vipInfo.cycleDays=((i=e.upgrade_vip)==null?void 0:i.cycle)||0,this.vipInfo.monthPrice=s[0]||0,this.vipInfo.priceIcon=s[1]==="G"?"gold":s[1]==="D"?"diamond":""},async getSubInfo(){const e=await y.getSubscriptionInfo();this.expireDate=e.pay_date,e.code===0?this.renewEnable=!e.willRemove:e.code===100&&(this.renewEnable=!0)},closePassDialog(){this.passDialogType=""},verifySuccess({passSha256:e}){this.passDialogType==="change"?(this.closePassDialog(),this.changeSubState(e)):(this.closePassDialog(),this.upgradeSubmit(e))},async upgradeSubmit(e){this.isLoading=!0;const s=await y.upgradeVip(e,this.monthNum);this.isLoading=!1,s.code===0?(this.$toast.success(this.$t("profileToastSuccess")),location.reload()):this.$toast.error(s.msg)},async changeSubState(e){this.isLoading=!0;const s=this.renewEnable?"removeSubscription":"resumeSubscription",n=await y[s](e);this.isLoading=!1,n.code===0?(this.$toast.success(this.$t("profileToastSuccess")),location.reload()):this.$toast.error(n.msg)}}},Q={class:"vip-card"},W={key:0,class:"vip-header is-0"},X={class:"vip-header-title"},Y={class:"vip-header-price"},Z={class:"mx-ml-10"},ee={class:"vip-header-cycle"},se={key:1,class:"vip-header is-1"},ie={class:"vip-header-title"},te={class:"vip-header-row"},oe={class:"mx-ml-5"},ne={key:0,class:"mx-ml-5"},ae={class:"mx-ml-5"},le={class:"mx-ml-5"},re={class:"vip-right-title"},ce={class:"mx-ml-10"},pe={class:"vip-right-name"},de=["innerHTML"],me={class:"pay-dialog-logo"},ue={class:"pay-dialog-title"},he={class:"pay-dialog-num"},ge={class:"pay-dialog-price"},fe={class:"pay-dialog-price-gold"},_e={class:"mx-ml-15"},ve={class:"pay-dialog-price-gold pay-dialog-price-big"},ye={class:"mx-ml-5"},be=["innerHTML"];function De(e,s,n,p,i,c){const m=N,g=k,b=M,_=$,V=A,E=I,T=J,P=O;return l(),v(P,{name:"asset",title:"vipTitle",onLoad:c.handleInit},{default:d(()=>[t("div",Q,[i.vipInfo.enabled?(l(),u("div",se,[t("div",ie,o(e.$t("vipEnabled")),1),t("div",te,[a(m,{icon:"vip-level-1",size:"15"}),t("b",oe,o(e.$t("vipTitle")),1),i.expireDate?(l(),u("span",ne,o(e.$t("vipExpire",{date:i.expireDate})),1)):f("",!0),a(g,{type:"none",class:"vip-header-btn is-small",disabled:i.isLoading,onClick:s[1]||(s[1]=r=>i.confirmDialogVisible=!0)},{default:d(()=>[h(o(e.$t("vipRenew")),1)]),_:1},8,["disabled"])]),t("div",{class:"vip-header-row",style:{cursor:"pointer"},onClick:s[2]||(s[2]=r=>i.passDialogType="change")},[a(m,{icon:i.renewEnable?"checked":"check",size:"13",style:{margin:"1px"}},null,8,["icon"]),t("b",ae,o(e.$t("vipAutoRenew")),1),t("span",le,o(e.$t("vipAutoRenewDesc")),1)])])):(l(),u("div",W,[t("div",X,o(e.$t("vipEnable")),1),t("div",Y,[a(m,{icon:`${i.vipInfo.priceIcon}-base`},null,8,["icon"]),t("span",Z,o(i.vipInfo.monthPrice),1),t("span",ee,o(e.$t("vipCircle",{days:i.vipInfo.cycleDays})),1)]),a(g,{type:"none",class:"vip-header-btn is-big",onClick:s[0]||(s[0]=r=>i.confirmDialogVisible=!0)},{default:d(()=>[h(o(e.$t("vipEnableBtn")),1)]),_:1})])),t("div",re,o(e.$t("vipRight")),1),(l(!0),u(C,null,K(i.rightKeys,r=>(l(),u("div",{key:r,class:"vip-right-item"},[a(m,{icon:`right-${r}`},null,8,["icon"]),t("div",ce,[t("div",pe,o(e.$t(`vipRightTitle_${r}`)),1),t("div",{class:"vip-right-desc",innerHTML:e.$t(`vipRightDesc_${r}`)},null,8,de)])]))),128))]),i.confirmDialogVisible?(l(),v(E,{key:0,title:"vipDialogTitle",class:"pay-dialog",close:!0,onClose:s[6]||(s[6]=r=>i.confirmDialogVisible=!1)},{default:d(()=>[t("div",me,[a(m,{icon:"vip-level-1"})]),t("div",ue,o(e.$t("vipDialogDesc",{days:c.totalDays})),1),t("div",he,[t("span",null,o(e.$t("vipDialogCount")),1),a(b,{modelValue:i.monthNum,"onUpdate:modelValue":s[3]||(s[3]=r=>i.monthNum=r),"max-disabled":c.goldNotEnough},null,8,["modelValue","max-disabled"])]),t("div",ge,[t("span",null,o(e.$t("vipDialogSingle")),1),a(m,{icon:`${i.vipInfo.priceIcon}-base`},null,8,["icon"]),t("span",fe,o(i.vipInfo.monthPrice),1),t("span",_e,o(e.$t("vipDialogTotal")),1),a(m,{icon:`${i.vipInfo.priceIcon}-base`,class:"pay-dialog-price-big"},null,8,["icon"]),t("span",ve,o(c.totalPrice),1)]),c.goldNotEnough?(l(),v(_,{key:0,class:"pay-dialog-alert is-link",target:"_blank",path:"/asset/activity"},{default:d(()=>[a(m,{icon:"warning"}),t("span",ye,o(e.$t("vipDialogError")),1)]),_:1})):f("",!0),a(g,{class:"pay-dialog-btn",type:"primary",disabled:c.confirmBtnDisabled,onClick:s[4]||(s[4]=r=>i.passDialogType="upgrade")},{default:d(()=>[h(o(e.$t("btnContirm")),1)]),_:1},8,["disabled"]),a(V,{modelValue:i.isAgree,"onUpdate:modelValue":s[5]||(s[5]=r=>i.isAgree=r),class:"pay-dialog-checkbox"},{default:d(()=>[t("div",{innerHTML:c.agreeHtml},null,8,be)]),_:1},8,["modelValue"])]),_:1})):f("",!0),i.passDialogType?(l(),v(T,{key:1,onCancel:c.closePassDialog,onSuccess:c.verifySuccess},null,8,["onCancel","onSuccess"])):f("",!0)]),_:1},8,["onLoad"])}const Be=L(q,[["render",De]]);export{Be as default};
